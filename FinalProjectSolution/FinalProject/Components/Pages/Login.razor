@page "/login"
@layout FinalProject.Components.Layout.AuthLayout
@rendermode InteractiveServer

@inject NavigationManager Nav

<h3>Login</h3>

@if (!string.IsNullOrEmpty(error))
{
    <div class="alert alert-danger">@error</div>
}
@if (!string.IsNullOrEmpty(success))
{
    <div class="alert alert-success">
        @success
    </div>
}


<form method="post" action="/api/login">
    <div class="mb-3">
        <label>Email</label>
        <input name="Email" class="form-control" required />
    </div>

    <div class="mb-3">
        <label>Password</label>
        <input name="Password" type="password" class="form-control" required />
    </div>

    <button class="btn btn-primary" type="submit">
        Login
    </button>

    <div class="mt-3">
        Belum punya akun? <a href="/register">Register</a>
    </div>
</form>

@code {
    private string? error;
    private string? success;

    protected override void OnInitialized()
    {
        var uri = Nav.ToAbsoluteUri(Nav.Uri);
        var query = Microsoft.AspNetCore.WebUtilities.QueryHelpers.ParseQuery(uri.Query);

        if (query.TryGetValue("error", out var message))
        {
            error = message;
        }

        if (query.TryGetValue("success", out var ok))
        {
            success = ok;
            _ = HideSuccessAfterDelay();
        }
    }
    private async Task HideSuccessAfterDelay()
    {
        await Task.Delay(5000); // 5 detik
        success = null;
        Nav.NavigateTo("/login", true);
        StateHasChanged();
    }
}